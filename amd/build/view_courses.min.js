define ("block_course_activities/view_courses",["jquery","core/notification","core/custom_interaction_events","core/str","core/templates","block_course_activities/event_list","core_course/repository","block_course_activities/calendar_events_repository"],function(a,b,c,d,e,f,g,h){var i={COURSE_ACTIVITIES_DAY_FILTER:"[data-region=\"course-filter\"]",COURSE_ACTIVITIES_DAY_FILTER_OPTION:"[data-from]",NO_COURSES_EMPTY_MESSAGE:"[data-region=\"no-courses-empty-message\"]",COURSES_LIST:"[data-region=\"courses-list\"]",COURSE_ITEMS_LOADING_PLACEHOLDER:"[data-region=\"course-items-loading-placeholder\"]",COURSE_EVENTS_CONTAINER:"[data-region=\"course-events-container\"]",COURSE_NAME:"[data-region=\"course-name\"]",LOADING_ICON:".loading-icon"},j={COURSE_ITEMS:"block_course_activities/course-items",LOADING_ICON:"core/loading"},k=5,l=86400,m=function(a){a.find(i.COURSE_ITEMS_LOADING_PLACEHOLDER).addClass("hidden")},n=function(a){a.find(i.MORE_COURSES_BUTTON_CONTAINER).addClass("hidden")},o=function(a){a.find(i.MORE_COURSES_BUTTON_CONTAINER).removeClass("hidden")},p=function(a){a.find(i.NO_COURSES_EMPTY_MESSAGE).removeClass("hidden")},q=function(a,b){var c=a.find(i.COURSES_LIST);e.appendNodeContents(c,b,"")},r=function(a){return 0<a.find(i.COURSE_EVENTS_CONTAINER).length},s=function(a){return parseInt(a.attr("data-offset"),10)},t=function(a,b){a.attr("data-offset",b)},u=function(a){return parseInt(a.attr("data-limit"),10)},v=function(a){return parseInt(a.attr("data-days-offset"),10)},w=function(a){var b=a.attr("data-days-limit");return b!=void 0?parseInt(b,10):void 0},x=function(a){var b=a.attr("data-course");return b!=void 0?b:void 0},y=function(a){return parseInt(a.attr("data-midnight"),10)},z=function(a){var b=y(a),c=v(a);return b+c*l},A=function(a){var b=y(a),c=w(a);return c!=void 0?b+c*l:!1},B=function(a,b,c,d){var e={courseids:a,starttime:b,limit:c};if(d){e.endtime=d}return h.queryByCourses(e)},C=function(a){return a.data("last-event-load-time")},D=function(a,b){a.data("last-event-load-time",b)},E=function(a,b){return C(a)>b},F=function(a,b,c){var d=a.map(function(a){return a.id});return B(d,b,k+1,c)},G=function(a,b,c,d,f,g,h){var i="undefined";a.forEach(function(a){if("course"+a.id==h){i=a}});return e.render(j.COURSE_ITEMS,{courses:i,midnight:c,hasdaysoffset:!0,hasdayslimit:f!=void 0,daysoffset:d,dayslimit:f,nodayslimit:f==void 0,urls:{noevents:g}}).then(function(a){m(b);if(a){q(b,a)}else{if(!r(b)){p(b)}}return a}).then(function(c){if(a.length<2){n(b)}else{o(b)}return c}).catch(function(){m(b)})},H=function(c){var e=s(c),h=u(c);return g.getEnrolledCoursesByTimelineClassification("inprogress",h,e,"fullname asc").then(function(b){var e=Date.now(),g=b.courses,h=b.nextoffset,i=v(c),j=w(c),l=y(c),m=z(c),n=A(c),o=x(c),p=c.attr("data-no-events-url");t(c,h);var q=F(g,m,n),r=G(g,c,l,i,j,p,o);return a.when(q,r).then(function(b){if(E(c,e)){return b}g.forEach(function(e){var g=e.id,h=[],i=c.find("[data-region=\"course-events-container\"][data-course-id=\""+g+"\"]"),j=i.find(f.rootSelector),l=b.groupedbycourse.filter(function(a){return a.courseid==g});if(l.length){h=l[0].events}var m=a.Deferred().resolve({events:h}).promise();d.get_string("ariaeventlistpaginationnavcourses","block_course_activities",e.fullnamedisplay).then(function(a){f.init(j,k,{1:m},a);return a}).catch(function(){f.init(j,k,{1:m})})});return b})}).catch(b.exception)},I=function(c){var e=Date.now(),g=z(c),h=A(c),j=c.find(i.COURSE_EVENTS_CONTAINER),l=j.map(function(){return a(this).attr("data-course-id")}).get();D(c,e);return B(l,g,k+1,h).then(function(b){if(E(c,e)){return b}j.each(function(c,e){e=a(e);var g=e.attr("data-course-id"),h=e.find(i.COURSE_NAME).text(),j=e.find(f.rootSelector),l=a.Deferred(),m=[],n=b.groupedbycourse.filter(function(a){return a.courseid==g});if(n.length){m=n[0].events}l.resolve({events:m});d.get_string("ariaeventlistpaginationnavcourses","block_course_activities",h).then(function(a){f.init(j,k,{1:l.promise()},a);return a}).catch(function(){f.init(j,k,{1:l.promise()})})});return b}).catch(b.exception)},J=function(a){var b=a.find(i.COURSE_ACTIVITIES_DAY_FILTER);c.define(b,[c.events.activate]);b.on(c.events.activate,i.COURSE_ACTIVITIES_DAY_FILTER_OPTION,function(b,c){alert("porrra");H(a);if(c){c.originalEvent.preventDefault();c.originalEvent.stopPropagation()}b.stopPropagation()})},K=function(a){if(!a.attr("data-seen")){if(r(a)){I(a)}else{H(a)}a.attr("data-seen",!0)}};return{init:function init(b){b=a(b);D(b,Date.now());if(b.hasClass("active")){H(b);b.attr("data-seen",!0)}J(b)},reset:function reset(a){a.removeAttr("data-seen");if(a.hasClass("active")){K(a)}},shown:K}});
//# sourceMappingURL=view_courses.min.js.map
